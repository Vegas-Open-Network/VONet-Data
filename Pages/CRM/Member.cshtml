@page "{id:int}"
@model VONetData.Pages.CRMMemberModel
@{
    ViewData["Title"] = "Member Detail";
}
<a href="/CRM" class="text-sm text-blue-700 hover:underline">? Back to CRM</a>
<h2 class="text-2xl font-bold mt-4 mb-4 text-gray-800">Connection Request Detail</h2>
@if (Model.Member == null)
{
    <div class="text-gray-600">Not found.</div>
}
else
{
    <div class="grid md:grid-cols-3 gap-6">
        <div class="md:col-span-2 space-y-4">
            <div class="border bg-white rounded p-4">
                <h3 class="font-semibold mb-2">Address</h3>
                <div class="text-sm">@Model.Member.StreetAddress @Model.Member.Unit</div>
                <div class="text-sm">@Model.Member.City, @Model.Member.State @Model.Member.ZipCode</div>
                <div class="text-xs text-gray-500 mt-2">Roof Access: @(Model.Member.RoofAccess?"Yes":"No")</div>
            </div>
            <div class="border bg-white rounded p-4">
                <h3 class="font-semibold mb-2">Status / Assignment</h3>
                <form method="post" class="space-y-3" asp-page-handler="UpdateMeta" asp-route-id="@Model.Member.Id">
                    <div class="grid md:grid-cols-2 gap-3">
                        <div>
                            <label class="text-xs font-semibold">Status</label>
                            <input name="Status" value="@Model.Status" class="border rounded w-full px-2 py-1" />
                        </div>
                        <div>
                            <label class="text-xs font-semibold">Assigned To</label>
                            <input name="AssignedTo" value="@Model.AssignedTo" class="border rounded w-full px-2 py-1" />
                        </div>
                    </div>
                    <button class="bg-blue-700 text-white px-4 py-2 rounded text-sm">Save</button>
                </form>
            </div>
            <div class="border bg-white rounded p-4">
                <h3 class="font-semibold mb-2">Notes</h3>
                <form method="post" asp-page-handler="AddNote" asp-route-id="@Model.Member.Id" class="flex gap-2 mb-3">
                    <input name="Note" class="border rounded flex-1 px-2 py-1" placeholder="Add note" />
                    <button class="bg-blue-700 text-white px-4 py-1 rounded text-sm">Add</button>
                </form>
                @if (Model.Notes.Count == 0)
                {
                    <div class="text-xs text-gray-500">No notes added.</div>
                }
                else
                {
                    <ul class="space-y-1 text-xs bg-gray-50 border rounded p-2 max-h-64 overflow-y-auto">
                    @foreach (var n in Model.Notes.AsEnumerable().Reverse())
                    {
                        <li>• @n</li>
                    }
                    </ul>
                }
            </div>
        </div>
        <div class="space-y-4">
            <div class="border bg-white rounded p-4">
                <h3 class="font-semibold mb-2">Metadata</h3>
                <div class="text-xs text-gray-600">ID: @Model.Member.Id</div>
                <div class="text-xs text-gray-600">Referral: @Model.Member.Referral</div>
                <div class="text-xs text-gray-600">UserId: @Model.Member.UserId</div>
                <form method="post" asp-page-handler="Delete" asp-route-id="@Model.Member.Id" onsubmit="return confirm('Delete this request?');" class="mt-4">
                    <button class="text-red-600 text-xs hover:underline">Delete Request</button>
                </form>
            </div>
        </div>
    </div>
}