@page
@model VONetData.Pages.CRMModel
@{
    ViewData["Title"] = "CRM Portal";
}
<h2 class="text-2xl font-bold mb-6 text-gray-800">CRM Portal</h2>
<div class="grid md:grid-cols-2 gap-8">
    <section>
        <h3 class="text-xl font-semibold mb-2">Recent Connection Requests</h3>
        <div class="border rounded bg-white p-4 max-h-[70vh] overflow-y-auto space-y-3">
            @if (Model.RecentMembers.Count == 0)
            {
                <div class="text-gray-500 text-sm">No connection requests found.</div>
            }
            else
            {
                @foreach (var m in Model.RecentMembers)
                {
                    <div class="border rounded p-3 hover:bg-blue-50 transition">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="font-semibold">@m.StreetAddress, @m.City</div>
                                <div class="text-xs text-gray-600">@m.State @m.ZipCode · Roof: @(m.RoofAccess ? "Yes" : "No")</div>
                                <div class="text-xs text-gray-500 mt-1">Status: @(CRMModel.MemberStatuses.ContainsKey(m.Id)? CRMModel.MemberStatuses[m.Id] : "—")</div>
                                <div class="text-xs text-gray-500">Assigned: @(CRMModel.MemberAssignments.ContainsKey(m.Id)? CRMModel.MemberAssignments[m.Id] : "—")</div>
                                <div class="text-[11px] text-gray-400 mt-1">Notes: @(CRMModel.MemberNotes.ContainsKey(m.Id)? CRMModel.MemberNotes[m.Id].Count : 0)</div>
                            </div>
                            <a href="/CRM/Member/@m.Id" class="text-blue-700 text-xs font-semibold hover:underline">Open</a>
                        </div>
                    </div>
                }
            }
        </div>
    </section>
    <section>
        <h3 class="text-xl font-semibold mb-2">Users</h3>
        <div class="border rounded bg-white p-4 max-h-[70vh] overflow-y-auto">
            @if (Model.Users.Count == 0)
            {
                <div class="text-gray-500 text-sm">No users found.</div>
            }
            else
            {
                <table class="w-full text-sm">
                    <thead>
                        <tr class="text-left border-b">
                            <th class="py-1 pr-2">Email</th>
                            <th class="py-1 pr-2">Username</th>
                            <th class="py-1 pr-2"></th>
                        </tr>
                    </thead>
                    <tbody>
                    @foreach (var u in Model.Users)
                    {
                        <tr class="border-b hover:bg-blue-50">
                            <td class="py-1 pr-2">@u.Email</td>
                            <td class="py-1 pr-2">@u.UserName</td>
                            <td class="py-1 pr-2 text-right"><a href="/CRM/User/@u.Id" class="text-blue-700 text-xs hover:underline">Open</a></td>
                        </tr>
                    }
                    </tbody>
                </table>
            }
        </div>
    </section>
</div>
